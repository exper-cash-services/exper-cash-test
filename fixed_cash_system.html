<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة العمليات المالية - Système de Gestion des Opérations Financières</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', 'Tahoma', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #312884, #4a3799);
            color: white;
            text-align: center;
            padding: 25px;
            position: relative;
        }
        
        .logo {
            position: absolute;
            top: 15px;
            right: 25px;
            width: 70px;
            height: 70px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .header h1 {
            font-size: 1.9em;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header .subtitle {
            font-size: 0.95em;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .header .company-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .user-info {
            position: absolute;
            top: 15px;
            left: 25px;
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .logout-btn {
            background: rgba(220,53,69,0.8);
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 15px;
            margin-left: 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(220,53,69,1);
        }
        
        .bilingual-text {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .ar-text {
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .fr-text {
            font-style: italic;
            opacity: 0.85;
            font-size: 0.9em;
        }
        
        .separator {
            color: #bdc3c7;
            margin: 0 5px;
        }
        
        /* Login Screen Styles */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        
        .login-header {
            margin-bottom: 30px;
        }
        
        .login-header h2 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.8em;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-group {
            text-align: right;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #312884;
            box-shadow: 0 0 0 3px rgba(49,40,132,0.1);
        }
        
        .login-btn {
            padding: 15px;
            background: linear-gradient(45deg, #312884, #4a3799);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(49,40,132,0.4);
        }
        
        /* Setup Screen Styles */
        .setup-screen {
            display: none;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .setup-container {
            max-width: 600px;
            margin: 50px auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .setup-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border-radius: 15px;
        }
        
        .identifier-input {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 3px solid #007bff;
        }
        
        .identifier-input h3 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .identifier-field {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .identifier-field input {
            padding: 15px;
            border: 2px solid #007bff;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            width: 200px;
        }
        
        /* Admin Panel Styles */
        .admin-panel {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
            padding: 20px;
            margin: 20px;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(220,53,69,0.3);
        }
        
        .admin-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .admin-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .admin-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .admin-btn:hover {
            background: white;
            color: #dc3545;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }
        
        .tab {
            flex: 1;
            min-width: 200px;
            padding: 18px 15px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            background: white;
            border-bottom-color: #312884;
            color: #312884;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(49,40,132,0.2);
        }
        
        .tab:hover:not(.active) {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        .tab-content {
            padding: 35px;
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-title {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            border: 2px solid #312884;
        }
        
        .page-title h2 {
            color: #2c3e50;
            font-size: 1.4em;
            margin-bottom: 10px;
        }

        .date-section {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(45deg, #e3f2fd, #bbdefb);
            border-radius: 10px;
        }

        .date-section label {
            font-weight: bold;
            font-size: 18px;
            color: #312884;
            margin-left: 15px;
        }

        .date-section input {
            padding: 12px;
            border: 2px solid #312884;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
        }

        .balances-section {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 3px solid #312884;
            box-shadow: 0 6px 20px rgba(49,40,132,0.1);
        }

        .balances-section h3 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.4em;
        }

        .balances-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        .balance-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            border-left: 6px solid;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .balance-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .balance-card.caisse {
            border-left-color: #28a745;
        }

        .balance-card.fundex {
            border-left-color: #007bff;
        }

        .balance-card.damane {
            border-left-color: #ffc107;
        }

        .balance-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
        }

        .balance-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .balance-input {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
            font-weight: bold;
            transition: border-color 0.3s ease;
        }

        .balance-input:focus {
            outline: none;
            border-color: #312884;
            box-shadow: 0 0 0 3px rgba(49,40,132,0.1);
        }

        .balance-final {
            background: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }
        
        .services-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 3px solid;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .services-section.caisse {
            border-color: #28a745;
        }

        .services-section.fundex {
            border-color: #007bff;
        }

        .services-section.damane {
            border-color: #ffc107;
        }
        
        .services-section h3 {
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-size: 1.3em;
        }

        .services-section.caisse h3 {
            border-bottom-color: #28a745;
            color: #28a745;
        }

        .services-section.fundex h3 {
            border-bottom-color: #007bff;
            color: #007bff;
        }

        .services-section.damane h3 {
            border-bottom-color: #ffc107;
            color: #e69500;
        }
        
        .service-category {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }

        .service-category h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 8px;
            text-align: center;
        }

        .service-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .service-column h5 {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 1em;
            text-align: center;
            font-weight: bold;
        }

        .service-column.credit h5 {
            background: linear-gradient(45deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 2px solid #28a745;
        }

        .service-column.credit h5:before {
            content: "✅ ";
            color: #28a745;
            font-size: 1.2em;
        }

        .service-column.debit h5 {
            background: linear-gradient(45deg, #f8d7da, #f1b0b7);
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .service-column.debit h5:before {
            content: "❌ ";
            color: #dc3545;
            font-size: 1.2em;
        }

        .service-row {
            display: grid;
            grid-template-columns: 2.5fr 1fr 1.2fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            background: linear-gradient(45deg, #f9f9f9, #f1f3f4);
            border-radius: 8px;
            border: 1px solid #e9ecef;
            transition: background 0.3s ease;
        }
        
        .service-row:hover {
            background: linear-gradient(45deg, #e9ecef, #dee2e6);
        }
        
        .service-row input {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            text-align: center;
            font-size: 13px;
            font-weight: bold;
            transition: border-color 0.3s ease;
        }

        .service-row input:focus {
            outline: none;
            border-color: #312884;
            box-shadow: 0 0 0 2px rgba(49,40,132,0.1);
        }

        .service-name {
            font-size: 13px;
            font-weight: bold;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .service-name img, .company-logo {
            width: 30px;
            height: 25px;
            object-fit: contain;
            border-radius: 4px;
            border: 1px solid #e1e5e9;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .service-name img:hover, .company-logo:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .company-logo {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: bold;
            text-align: center;
        }
        
        .btn {
            padding: 14px 35px;
            background: linear-gradient(45deg, #312884, #4a3799);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            margin: 12px 8px;
            box-shadow: 0 3px 10px rgba(49,40,132,0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(49,40,132,0.4);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #28a745, #1e7e34);
            box-shadow: 0 3px 10px rgba(40,167,69,0.3);
        }
        
        .btn-info {
            background: linear-gradient(45deg, #17a2b8, #138496);
            box-shadow: 0 3px 10px rgba(23,162,184,0.3);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #ffc107, #e0a800);
            box-shadow: 0 3px 10px rgba(255,193,7,0.3);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
            box-shadow: 0 3px 10px rgba(220,53,69,0.3);
        }
        
        .total-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .total-all-card {
            background: linear-gradient(45deg, #312884, #4a3799);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 8px 25px rgba(49,40,132,0.4);
            transition: transform 0.3s ease;
            border: 3px solid #fbbb0b;
        }

        .total-all-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 35px rgba(49,40,132,0.6);
        }

        .total-card {
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .total-card:hover {
            transform: translateY(-5px);
        }

        .total-card.caisse {
            background: linear-gradient(45deg, #28a745, #20c997);
        }

        .total-card.fundex {
            background: linear-gradient(45deg, #007bff, #0056b3);
        }

        .total-card.damane {
            background: linear-gradient(45deg, #ffc107, #e0a800);
            color: #2c3e50;
        }

        .total-card h4 {
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .total-amount {
            font-size: 1.8em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .instructions {
            background: linear-gradient(45deg, #e8f4fd, #d1ecf1);
            padding: 25px;
            border-radius: 12px;
            margin-top: 25px;
            border-left: 6px solid #312884;
            box-shadow: 0 4px 15px rgba(49,40,132,0.1);
        }

        .instructions h4 {
            color: #312884;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .instructions ul {
            list-style: none;
            padding-right: 0;
        }

        .instructions li {
            margin-bottom: 12px;
            padding-right: 25px;
            font-size: 15px;
            line-height: 1.5;
        }

        .instructions li:before {
            content: "✓ ";
            color: #fbbb0b;
            font-weight: bold;
            margin-left: 10px;
            font-size: 1.2em;
        }

        .report-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .report-header {
            text-align: center;
            border-bottom: 3px solid #2c3e50;
            padding-bottom: 25px;
            margin-bottom: 30px;
        }

        .report-header img {
            width: 80px;
            float: right;
            margin-top: -15px;
            border-radius: 8px;
        }

        .report-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 12px rgba(0,0,0,0.1);
        }

        .stat-card.caisse-stat {
            background: linear-gradient(45deg, #d4edda, #c3e6cb);
            border: 2px solid #28a745;
        }

        .stat-card.fundex-stat {
            background: linear-gradient(45deg, #cce5ff, #b3d9ff);
            border: 2px solid #007bff;
        }

        .stat-card.damane-stat {
            background: linear-gradient(45deg, #fff3cd, #ffe69c);
            border: 2px solid #ffc107;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .history-table thead tr {
            background: linear-gradient(45deg, #312884, #4a3799);
            color: white;
        }

        .history-table th,
        .history-table td {
            padding: 15px 12px;
            border: 1px solid #dee2e6;
            text-align: center;
        }

        .history-table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        .history-table tbody tr:hover {
            background: linear-gradient(45deg, #e3f2fd, #bbdefb);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            width: 400px;
            max-width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideIn 0.3s;
        }

        .modal h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .modal-input {
            padding: 15px;
            font-size: 18px;
            border: 2px solid #007bff;
            border-radius: 8px;
            width: 200px;
            text-align: center;
            margin: 15px;
        }

        .modal-input:focus {
            outline: none;
            border-color: #0056b3;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.2);
        }

        .modal-buttons {
            margin-top: 25px;
        }

        .modal-btn {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .modal-btn.confirm {
            background: #007bff;
            color: white;
        }

        .modal-btn.confirm:hover {
            background: #0056b3;
        }

        .modal-btn.cancel {
            background: #6c757d;
            color: white;
        }

        .modal-btn.cancel:hover {
            background: #545b62;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Print Styles */
        .print-hidden {
            display: none !important;
        }
        
        @media print {
            body {
                background: white !important;
                padding: 0 !important;
            }
            
            .container {
                box-shadow: none !important;
                border-radius: 0 !important;
                margin: 0 !important;
                max-width: 100% !important;
            }
            
            .tabs, .admin-panel, .user-info, .logout-btn {
                display: none !important;
            }
            
            .tab-content {
                display: block !important;
                padding: 20px !important;
            }
            
            .tab-content:not(.active) {
                display: none !important;
            }
            
            .print-hidden {
                display: none !important;
            }
            
            .service-row {
                page-break-inside: avoid;
                margin-bottom: 6px;
            }
            
            .btn, button {
                display: none !important;
            }
            
            .page-title {
                page-break-after: avoid;
                margin-bottom: 15px;
            }
            
            .services-section {
                page-break-inside: avoid;
                margin-bottom: 20px;
            }
            
            .balances-section {
                page-break-after: avoid;
                margin-bottom: 25px;
            }
            
            .instructions {
                display: none !important;
            }
            
            .header h1 {
                font-size: 1.6em;
            }
            
            .bilingual-text {
                font-size: 13px;
            }
            
            .total-all-card {
                background: #f8f9fa !important;
                color: #312884 !important;
                border: 2px solid #312884 !important;
            }
        }

        @media (max-width: 768px) {
            .service-columns {
                grid-template-columns: 1fr;
            }
            
            .balances-grid {
                grid-template-columns: 1fr;
            }
            
            .service-row {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 8px;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                min-width: auto;
            }

            .company-info {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <img src="https://www.adm.co.ma/sites/default/files/inline-images/logo_damanecash_vf_bb1.png" 
                     alt="Logo" style="width: 80px; margin-bottom: 20px;" onerror="this.style.display='none'">
                <div class="bilingual-text">
                    <h2>تسجيل الدخول</h2>
                    <span class="separator">|</span>
                    <h2 class="fr-text">Connexion</h2>
                </div>
                <div class="bilingual-text" style="color: #666; margin-top: 10px;">
                    <span>EXPER CASH SERVICES SARL</span>
                    <span class="separator">|</span>
                    <span class="fr-text">Système de Gestion Financière</span>
                </div>
            </div>
            
            <form class="login-form" onsubmit="login(event)">
                <div class="form-group">
                    <div class="bilingual-text">
                        <label>نوع المستخدم</label>
                        <span class="separator">|</span>
                        <label class="fr-text">Type d'utilisateur</label>
                    </div>
                    <select id="userType" required>
                        <option value="">اختر نوع المستخدم - Choisir le type</option>
                        <option value="admin">👨‍💼 مدير النظام - Administrateur</option>
                        <option value="user">👤 مستخدم عادي - Utilisateur</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <div class="bilingual-text">
                        <label>كلمة المرور</label>
                        <span class="separator">|</span>
                        <label class="fr-text">Mot de passe</label>
                    </div>
                    <input type="password" id="password" required placeholder="••••••••">
                </div>
                
                <button type="submit" class="login-btn">
                    <div class="bilingual-text">
                        <span>🔐 دخول</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Se connecter</span>
                    </div>
                </button>
            </form>
            
            <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; font-size: 14px; color: #666;">
                <div class="bilingual-text" style="margin-bottom: 10px; font-weight: bold;">
                    <span>معلومات تسجيل الدخول الافتراضية</span>
                    <span class="separator">|</span>
                    <span class="fr-text">Informations de connexion par défaut</span>
                </div>
                <div class="bilingual-text" style="margin-bottom: 5px;">
                    <span>مدير النظام: admin123</span>
                    <span class="separator">|</span>
                    <span class="fr-text">Admin: admin123</span>
                </div>
                <div class="bilingual-text">
                    <span>مستخدم عادي: user123</span>
                    <span class="separator">|</span>
                    <span class="fr-text">Utilisateur: user123</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Setup Screen -->
    <div id="setupScreen" class="setup-screen">
        <div class="setup-container">
            <div class="setup-header">
                <div class="bilingual-text">
                    <h2>🎯 إعداد أولي للنظام</h2>
                    <span class="separator">|</span>
                    <h2 class="fr-text">Configuration Initiale du Système</h2>
                </div>
                <div class="bilingual-text" style="margin-top: 10px; font-size: 16px;">
                    <span>مرحباً بك في أول استخدام للنظام</span>
                    <span class="separator">|</span>
                    <span class="fr-text">Bienvenue dans votre première utilisation</span>
                </div>
            </div>
            
            <div class="identifier-input">
                <div class="bilingual-text">
                    <h3>أدخل معرف الشركة</h3>
                    <span class="separator">|</span>
                    <h3 class="fr-text">Saisir l'identifiant de l'entreprise</h3>
                </div>
                
                <div class="identifier-field">
                    <div class="bilingual-text">
                        <label style="font-weight: bold; color: #2c3e50;">المعرف:</label>
                        <span class="separator">|</span>
                        <label class="fr-text" style="font-weight: bold; color: #2c3e50;">Identifiant:</label>
                    </div>
                    <input type="text" id="companyIdentifier" placeholder="مثال: 5447 - Ex: 5447" 
                           style="text-align: center; font-size: 20px;" maxlength="10">
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(0,123,255,0.1); border-radius: 8px; font-size: 14px; color: #0066cc;">
                    <div class="bilingual-text">
                        <span>💡 هذا المعرف سيظهر في جميع التقارير والوثائق</span>
                        <span class="separator">|</span>
                        <span class="fr-text">💡 Cet identifiant apparaîtra dans tous les rapports</span>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button class="btn btn-success" onclick="setupSystem()" style="font-size: 18px; padding: 15px 40px;">
                    <div class="bilingual-text">
                        <span>✅ حفظ وبدء النظام</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Enregistrer et Démarrer</span>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="container" style="display: none;">
        <div class="header">
            <div class="user-info">
                <span id="currentUser">👤 مستخدم</span>
                <button class="logout-btn" onclick="logout()">خروج</button>
            </div>
            
            <img src="https://www.adm.co.ma/sites/default/files/inline-images/logo_damanecash_vf_bb1.png" 
                 alt="Logo" class="logo" onerror="this.style.display='none'">
            <h1>EXPER CASH SERVICES SARL</h1>
            <div class="subtitle bilingual-text">
                <span class="ar-text">نظام إدارة العمليات المالية الشامل</span>
                <span class="separator">|</span>
                <span class="fr-text">Système de Gestion des Opérations Financières Complet</span>
            </div>
            <div class="company-info">
                <img src="https://www.adm.co.ma/sites/default/files/inline-images/logo_damanecash_vf_bb1.png" 
                     alt="ضمان كاش" style="width: 50px; height: 50px; border-radius: 8px;" onerror="this.style.display='none'">
                <div class="bilingual-text">
                    <span class="ar-text">المعرف: <span id="displayIdentifier">---</span></span>
                    <span class="separator">|</span>
                    <span class="fr-text">Identifiant: <span id="displayIdentifierFr">---</span></span>
                </div>
            </div>
        </div>

        <!-- Admin Panel (Only visible for admin users) -->
        <div id="adminPanel" class="admin-panel" style="display: none;">
            <div class="bilingual-text" style="font-size: 20px; font-weight: bold; text-align: center; margin-bottom: 15px;">
                <span>🛠️ لوحة تحكم المدير</span>
                <span class="separator">|</span>
                <span class="fr-text">Panneau d'Administration</span>
            </div>
            
            <div class="admin-controls">
                <div class="admin-card">
                    <div class="bilingual-text" style="font-weight: bold; margin-bottom: 15px;">
                        <span>🏢 إدارة معرف الشركة</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Gestion Identifiant</span>
                    </div>
                    <div class="bilingual-text" style="margin-bottom: 10px; font-size: 14px;">
                        <span>المعرف الحالي: <span id="currentIdentifier">---</span></span>
                        <span class="separator">|</span>
                        <span class="fr-text">ID Actuel: <span id="currentIdentifierFr">---</span></span>
                    </div>
                    <button class="admin-btn" onclick="changeIdentifier()">
                        <div class="bilingual-text">
                            <span>✏️ تغيير المعرف</span>
                            <span class="separator">|</span>
                            <span class="fr-text">Modifier ID</span>
                        </div>
                    </button>
                </div>
                
                <div class="admin-card">
                    <div class="bilingual-text" style="font-weight: bold; margin-bottom: 15px;">
                        <span>🗄️ إدارة البيانات</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Gestion des Données</span>
                    </div>
                    <button class="admin-btn" onclick="backupData()">
                        <div class="bilingual-text">
                            <span>💾 نسخ احتياطي</span>
                            <span class="separator">|</span>
                            <span class="fr-text">Sauvegarde</span>
                        </div>
                    </button>
                    <button class="admin-btn" onclick="clearAllData()" style="border-color: #dc3545; color: #dc3545;">
                        <div class="bilingual-text">
                            <span>🗑️ مسح الكل</span>
                            <span class="separator">|</span>
                            <span class="fr-text">Effacer Tout</span>
                        </div>
                    </button>
                </div>
                
                <div class="admin-card">
                    <div class="bilingual-text" style="font-weight: bold; margin-bottom: 15px;">
                        <span>📊 إحصائيات النظام</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Statistiques Système</span>
                    </div>
                    <div style="font-size: 14px; margin-bottom: 10px;">
                        <div class="bilingual-text">
                            <span>عدد السجلات: <span id="recordCount">0</span></span>
                            <span class="separator">|</span>
                            <span class="fr-text">Enregistrements: <span id="recordCountFr">0</span></span>
                        </div>
                    </div>
                    <button class="admin-btn" onclick="refreshStats()">
                        <div class="bilingual-text">
                            <span>🔄 تحديث</span>
                            <span class="separator">|</span>
                            <span class="fr-text">Actualiser</span>
                        </div>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('saisie', this)">
                <div class="bilingual-text">
                    <span>📝 إدخال يومي</span>
                    <span class="separator">|</span>
                    <span class="fr-text">Saisie Quotidienne</span>
                </div>
            </button>
            <button class="tab" onclick="switchTab('rapport-jour', this)">
                <div class="bilingual-text">
                    <span>📊 تقرير يومي</span>
                    <span class="separator">|</span>
                    <span class="fr-text">Rapport Journalier</span>
                </div>
            </button>
            <button class="tab" onclick="switchTab('rapport-mensuel', this)">
                <div class="bilingual-text">
                    <span>📈 تقرير شهري</span>
                    <span class="separator">|</span>
                    <span class="fr-text">Rapport Mensuel</span>
                </div>
            </button>
            <button class="tab" onclick="switchTab('historique', this)">
                <div class="bilingual-text">
                    <span>📚 السجل التاريخي</span>
                    <span class="separator">|</span>
                    <span class="fr-text">Historique</span>
                </div>
            </button>
        </div>
        
        <!-- إدخال يومي -->
        <div id="saisie" class="tab-content active">
            <div class="page-title">
                <div class="bilingual-text">
                    <h2>الإدخال اليومي للعمليات</h2>
                    <span class="separator">|</span>
                    <h2 class="fr-text">Saisie Quotidienne des Opérations</h2>
                </div>
            </div>
            
            <div class="date-section">
                <div class="bilingual-text">
                    <label>التاريخ:</label>
                    <label class="fr-text">Date:</label>
                </div>
                <input type="date" id="date" style="margin-right: 15px;">
            </div>

            <!-- الأرصدة الثلاثة -->
            <div class="balances-section">
                <div class="bilingual-text">
                    <h3>الأرصدة الثلاثة</h3>
                    <span class="separator">|</span>
                    <h3 class="fr-text">Les Trois Soldes</h3>
                </div>
                <div class="balances-grid">
                    <!-- الصندوق -->
                    <div class="balance-card caisse">
                        <div class="balance-title">
                            <div class="bilingual-text">
                                <span>💵 الصندوق</span>
                                <span class="separator">|</span>
                                <span class="fr-text">CAISSE</span>
                            </div>
                        </div>
                        <div class="balance-inputs">
                            <input type="number" id="caisse-initial" class="balance-input" 
                                   placeholder="الرصيد الابتدائي / Solde Initial" step="0.01">
                            <input type="number" id="caisse-j1" class="balance-input" 
                                   placeholder="J-1" step="0.01">
                            <input type="number" id="caisse-final" class="balance-input balance-final" 
                                   placeholder="الرصيد النهائي / Solde Final" readonly>
                        </div>
                    </div>
                    
                    <!-- Fundex -->
                    <div class="balance-card fundex">
                        <div class="balance-title">
                            <div class="bilingual-text">
                                <span>🔄 فنديكس</span>
                                <span class="separator">|</span>
                                <span class="fr-text">FUNDEX</span>
                            </div>
                        </div>
                        <div class="balance-inputs">
                            <input type="number" id="fundex-initial" class="balance-input" 
                                   placeholder="الرصيد الابتدائي / Solde Initial" step="0.01">
                            <input type="number" id="fundex-j1" class="balance-input" 
                                   placeholder="J-1" step="0.01">
                            <input type="number" id="fundex-final" class="balance-input balance-final" 
                                   placeholder="الرصيد النهائي / Solde Final" readonly>
                        </div>
                    </div>
                    
                    <!-- Damane Pay -->
                    <div class="balance-card damane">
                        <div class="balance-title">
                            <div class="bilingual-text">
                                <span>💳 ضمان باي</span>
                                <span class="separator">|</span>
                                <span class="fr-text">DAMANE PAY</span>
                            </div>
                        </div>
                        <div class="balance-inputs">
                            <input type="number" id="damane-initial" class="balance-input" 
                                   placeholder="الرصيد الابتدائي / Solde Initial" step="0.01">
                            <input type="number" id="damane-j1" class="balance-input" 
                                   placeholder="J-1" step="0.01">
                            <input type="number" id="damane-final" class="balance-input balance-final" 
                                   placeholder="الرصيد النهائي / Solde Final" readonly>
                        </div>
                    </div>
                </div>
            </div>

            <!-- عمليات الصندوق -->
            <div class="services-section caisse">
                <div class="bilingual-text">
                    <h3>💵 عمليات الصندوق</h3>
                    <span class="separator">|</span>
                    <h3 class="fr-text">Opérations CAISSE</h3>
                </div>
                
                <div class="service-category">
                    <div class="service-columns">
                        <div class="service-column credit">
                            <div class="bilingual-text">
                                <h5>دائن (+)</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">CRÉDIT (+)</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #27AE60, #2ECC71); color: white;">💰</div>
                                    <div class="bilingual-text">
                                        <span>النقد المضاف للصندوق</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Espèces Ajoutées</span>
                                    </div>
                                </span>
                                <input type="number" id="caisse-credit-espece-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="caisse-credit-espece-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #2B6CB0, #3182CE); color: white;">🏦</div>
                                    <div class="bilingual-text">
                                        <span>البنك</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Banque</span>
                                    </div>
                                </span>
                                <input type="number" id="caisse-credit-banque-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="caisse-credit-banque-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="bilingual-text">
                                        <span>📋 أخرى</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Autres</span>
                                    </div>
                                </span>
                                <input type="number" id="caisse-credit-others-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="caisse-credit-others-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                        
                        <div class="service-column debit">
                            <div class="bilingual-text">
                                <h5>مدين (-)</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">DÉBIT (-)</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #E74C3C, #C0392B); color: white;">💸</div>
                                    <div class="bilingual-text">
                                        <span>النقد المسحوب</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Espèces Retirées</span>
                                    </div>
                                </span>
                                <input type="number" id="caisse-debit-espece-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="caisse-debit-espece-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="bilingual-text">
                                        <span>📋 أخرى</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Autres</span>
                                    </div>
                                </span>
                                <input type="number" id="caisse-debit-others-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="caisse-debit-others-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- عمليات Fundex -->
            <div class="services-section fundex">
                <div class="bilingual-text">
                    <h3>🔄 عمليات فنديكس</h3>
                    <span class="separator">|</span>
                    <h3 class="fr-text">Opérations FUNDEX</h3>
                </div>
                
                <!-- التحويل الدولي -->
                <div class="service-category">
                    <div class="bilingual-text">
                        <h4>🌍 التحويل الدولي</h4>
                        <span class="separator">|</span>
                        <span class="fr-text">Transfert International</span>
                    </div>
                    <div class="service-columns">
                        <div class="service-column credit">
                            <div class="bilingual-text">
                                <h5>دائن (+) - استقبال</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">CRÉDIT (+) - Réception</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #FFD700, #FFA500); color: black;">WU</div>
                                    <div class="bilingual-text">
                                        <span>استقبال ويسترن يونيون</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Western Union Réception</span>
                                    </div>
                                </span>
                                <input type="number" id="fundex-wu-reception-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="fundex-wu-reception-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #E53E3E, #C53030); color: white;">MG</div>
                                    <div class="bilingual-text">
                                        <span>موني جرام</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">MoneyGram</span>
                                    </div>
                                </span>
                                <input type="number" id="fundex-mg-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="fundex-mg-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #2B6CB0, #3182CE); color: white;">MI</div>
                                    <div class="bilingual-text">
                                        <span>موني انترناشيونال</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Money International</span>
                                    </div>
                                </span>
                                <input type="number" id="fundex-mi-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="fundex-mi-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="bilingual-text">
                                        <span>📋 أخرى</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Autres</span>
                                    </div>
                                </span>
                                <input type="number" id="fundex-int-other-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="fundex-int-other-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                        
                        <div class="service-column debit">
                            <div class="bilingual-text">
                                <h5>مدين (-) - إرسال</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">DÉBIT (-) - Envoi</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #FFD700, #FFA500); color: black;">WU</div>
                                    <div class="bilingual-text">
                                        <span>إرسال ويسترن يونيون</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Western Union Envois</span>
                                    </div>
                                </span>
                                <input type="number" id="fundex-wu-envois-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="fundex-wu-envois-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- التحويل الوطني -->
                <div class="service-category">
                    <div class="bilingual-text">
                        <h4>🚀 التحويل الوطني - رابيدو</h4>
                        <span class="separator">|</span>
                        <span class="fr-text">Transfert National - RAPIDO</span>
                    </div>
                    <div class="service-columns">
                        <div class="service-column credit">
                            <div class="bilingual-text">
                                <h5>دائن (+) - استقبال</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">CRÉDIT (+) - Réception</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #FF6B35, #F7931E); color: white;">R</div>
                                    <div class="bilingual-text">
                                        <span>استقبال رابيدو</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Rapido Réceptions</span>
                                    </div>
                                </span>
                                <input type="number" id="fundex-rapido-reception-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="fundex-rapido-reception-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                        
                        <div class="service-column debit">
                            <div class="bilingual-text">
                                <h5>مدين (-) - إرسال</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">DÉBIT (-) - Envoi</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #FF6B35, #F7931E); color: white;">R</div>
                                    <div class="bilingual-text">
                                        <span>إرسال رابيدو</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Rapido Envois</span>
                                    </div>
                                </span>
                                <input type="number" id="fundex-rapido-envois-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="fundex-rapido-envois-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- خدمات أخرى -->
                <div class="service-category">
                    <div class="bilingual-text">
                        <h4>🛠️ خدمات أخرى</h4>
                        <span class="separator">|</span>
                        <span class="fr-text">Autres Services</span>
                    </div>
                    <div class="service-columns">
                        <div class="service-column credit">
                            <div class="bilingual-text">
                                <h5>دائن (+)</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">CRÉDIT (+)</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="bilingual-text">
                                        <span>⚡ شحن رصيد فنديكس</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Charge Sold Fundex</span>
                                    </div>
                                </span>
                                <input type="number" id="fundex-decharge-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="fundex-decharge-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                        
                        <div class="service-column debit">
                            <div class="bilingual-text">
                                <h5>مدين (-)</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">DÉBIT (-)</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="bilingual-text">
                                        <span>💳 شحن إلى ضمان باي</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Décharge vers Damane Pay</span>
                                    </div>
                                </span>
                                <input type="number" id="fundex-charge-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="fundex-charge-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="bilingual-text">
                                        <span>🚗 الضريبة على السيارات</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Taxe sur Véhicules</span>
                                    </div>
                                </span>
                                <input type="number" id="fundex-vignette-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="fundex-vignette-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- عمليات Damane Pay -->
            <div class="services-section damane">
                <div class="bilingual-text">
                    <h3>💳 عمليات ضمان باي</h3>
                    <span class="separator">|</span>
                    <h3 class="fr-text">Opérations DAMANE PAY</h3>
                </div>
                
                <!-- العمليات الأساسية -->
                <div class="service-category">
                    <div class="bilingual-text">
                        <h4>⚙️ العمليات الأساسية</h4>
                        <span class="separator">|</span>
                        <span class="fr-text">Opérations de Base</span>
                    </div>
                    <div class="service-columns">
                        <div class="service-column credit">
                            <div class="bilingual-text">
                                <h5>دائن (+)</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">CRÉDIT (+)</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="bilingual-text">
                                        <span>👤 سحب عميل</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Retrait Client</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-retrait-client-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-retrait-client-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #16A085, #48C9B0); color: white; font-size: 6px; text-align: center; line-height: 25px; font-weight: bold;">CNSS</div>
                                    <div class="bilingual-text">
                                        <span>🏛️ دفع الضمان الاجتماعي</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Paiement CNSS</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-cnss-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-cnss-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="bilingual-text">
                                        <span>⚡ شحن رصيد</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Charge Sold</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-charge-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-charge-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                        
                        <div class="service-column debit">
                            <div class="bilingual-text">
                                <h5>مدين (-)</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">DÉBIT (-)</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #2B6CB0, #3182CE); color: white; font-size: 6px; text-align: center; line-height: 25px; font-weight: bold;">BOA</div>
                                    <div class="bilingual-text">
                                        <span>🏦 تفريغ إلى حساب</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Décharge vers compte BOA</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-decharge-boa-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-decharge-boa-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="bilingual-text">
                                        <span>💳 تحويل إلى كونسول آخر</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Versement dp to other console</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-versement-dp-console-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-versement-dp-console-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="bilingual-text">
                                        <span>🏧 تحويل إلى حساب بنكي</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Virement à compte banq</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-virement-banque-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-virement-banque-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="bilingual-text">
                                        <span>👤 إيداع عميل</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Versement Client</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-versement-client-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-versement-client-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- التحويل الدولي -->
                <div class="service-category">
                    <div class="bilingual-text">
                        <h4>🌍 التحويل الدولي</h4>
                        <span class="separator">|</span>
                        <span class="fr-text">Transfert International</span>
                    </div>
                    <div class="service-columns">
                        <div class="service-column credit">
                            <div class="bilingual-text">
                                <h5>دائن (+) - استقبال</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">CRÉDIT (+) - Réception</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #FF6B35, #F7931E); color: white;">RIA</div>
                                    <div class="bilingual-text">
                                        <span>ريا</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">RIA</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-ria-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-ria-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #E53E3E, #C53030); color: white;">MG</div>
                                    <div class="bilingual-text">
                                        <span>موني جرام</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Money Gram</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-mg-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-mg-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #2E8B57, #32CD32); color: white;">DE</div>
                                    <div class="bilingual-text">
                                        <span>🇲🇦 درهم اكسبريس</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">DIRHAM EXPRESS</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-dirham-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-dirham-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #1E3A8A, #3B82F6); color: white;">AL</div>
                                    <div class="bilingual-text">
                                        <span>🇦🇪 الأنصاري للصرافة</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">AL ANSARI EXCHANGE</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-ansari-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-ansari-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="bilingual-text">
                                        <span>📋 أخرى</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Autres</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-int-autres-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-int-autres-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                        
                        <div class="service-column debit">
                            <div class="bilingual-text">
                                <h5>مدين (-) - إرسال</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">DÉBIT (-) - Envoi</span>
                            </div>
                            <!-- فارغ -->
                        </div>
                    </div>
                </div>

                <!-- التحويل الوطني -->
                <div class="service-category">
                    <div class="bilingual-text">
                        <h4>📨 التحويل الوطني - مانديت اكسبريس</h4>
                        <span class="separator">|</span>
                        <span class="fr-text">Transfert National - MANDAT EXPRESS</span>
                    </div>
                    <div class="service-columns">
                        <div class="service-column credit">
                            <div class="bilingual-text">
                                <h5>دائن (+) - استقبال</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">CRÉDIT (+) - Réception</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #7B68EE, #9370DB); color: white;">ME</div>
                                    <div class="bilingual-text">
                                        <span>📨 استقبال مانديت اكسبريس</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Mandat Express Réceptions</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-mandat-reception-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-mandat-reception-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                        
                        <div class="service-column debit">
                            <div class="bilingual-text">
                                <h5>مدين (-) - إرسال</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">DÉBIT (-) - Envoi</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #7B68EE, #9370DB); color: white;">ME</div>
                                    <div class="bilingual-text">
                                        <span>📤 إرسال مانديت اكسبريس</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Mandat Express Envois</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-mandat-envois-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-mandat-envois-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- خدمات أخرى -->
                <div class="service-category">
                    <div class="bilingual-text">
                        <h4>🛠️ خدمات أخرى</h4>
                        <span class="separator">|</span>
                        <span class="fr-text">Autres Services</span>
                    </div>
                    <div class="service-columns">
                        <div class="service-column credit">
                            <div class="bilingual-text">
                                <h5>دائن (+)</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">CRÉDIT (+)</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="company-logo" style="background: linear-gradient(45deg, #7B68EE, #9370DB); color: white;">DP</div>
                                    <div class="bilingual-text">
                                        <span>💳 بيع بطاقة ضمان باي</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Vente Carte Damane Pay</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-vente-carte-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-vente-carte-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                        
                        <div class="service-column debit">
                            <div class="bilingual-text">
                                <h5>مدين (-)</h5>
                                <span class="separator">|</span>
                                <span class="fr-text">DÉBIT (-)</span>
                            </div>
                            <div class="service-row">
                                <span class="service-name">
                                    <div class="bilingual-text">
                                        <span>🧾 جميع الفواتير</span>
                                        <span class="separator">|</span>
                                        <span class="fr-text">Toutes Factures</span>
                                    </div>
                                </span>
                                <input type="number" id="damane-factures-nbre" min="0" placeholder="العدد / Nbr">
                                <input type="number" id="damane-factures-montant" step="0.01" placeholder="المبلغ / Mont.">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- الأرصدة النهائية -->
            <div class="total-section">
                <div class="total-card caisse">
                    <div class="bilingual-text">
                        <h4>💵 الصندوق</h4>
                        <span class="separator">|</span>
                        <h4 class="fr-text">CAISSE</h4>
                    </div>
                    <div class="total-amount" id="total-caisse">0.00</div>
                    <div class="bilingual-text">
                        <small>درهم</small>
                        <span class="separator">|</span>
                        <small class="fr-text">MAD</small>
                    </div>
                </div>
                
                <div class="total-card fundex">
                    <div class="bilingual-text">
                        <h4>🔄 فنديكس</h4>
                        <span class="separator">|</span>
                        <h4 class="fr-text">FUNDEX</h4>
                    </div>
                    <div class="total-amount" id="total-fundex">0.00</div>
                    <div class="bilingual-text">
                        <small>درهم</small>
                        <span class="separator">|</span>
                        <small class="fr-text">MAD</small>
                    </div>
                </div>
                
                <div class="total-card damane">
                    <div class="bilingual-text">
                        <h4>💳 ضمان باي</h4>
                        <span class="separator">|</span>
                        <h4 class="fr-text">DAMANE PAY</h4>
                    </div>
                    <div class="total-amount" id="total-damane">0.00</div>
                    <div class="bilingual-text">
                        <small>درهم</small>
                        <span class="separator">|</span>
                        <small class="fr-text">MAD</small>
                    </div>
                </div>
                
                <!-- بطاقة المجموع الإجمالي الجديدة -->
                <div class="total-all-card">
                    <div class="bilingual-text">
                        <h4>📊 المجموع الإجمالي</h4>
                        <span class="separator">|</span>
                        <h4 class="fr-text">TOTAL GÉNÉRAL</h4>
                    </div>
                    <div class="total-amount" id="total-all" style="font-size: 2.2em; text-shadow: 3px 3px 6px rgba(0,0,0,0.5);">0.00</div>
                    <div class="bilingual-text">
                        <small>درهم مغربي</small>
                        <span class="separator">|</span>
                        <small class="fr-text">DIRHAM MAROCAIN</small>
                    </div>
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.3);">
                        <div class="bilingual-text" style="font-size: 12px; opacity: 0.9;">
                            <span>إجمالي يوم العمل</span>
                            <span class="separator">|</span>
                            <span class="fr-text">Total Journée de Travail</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 35px;">
                <button class="btn btn-success" onclick="saveData()">
                    <div class="bilingual-text">
                        <span>💾 حفظ البيانات</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Sauvegarder</span>
                    </div>
                </button>
                <button class="btn" onclick="calculateTotals()">
                    <div class="bilingual-text">
                        <span>🧮 إعادة الحساب</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Recalculer</span>
                    </div>
                </button>
                <button class="btn btn-warning" onclick="clearForm()">
                    <div class="bilingual-text">
                        <span>🗑️ مسح الحقول</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Effacer</span>
                    </div>
                </button>
                <button class="btn btn-info" onclick="smartPrint()">
                    <div class="bilingual-text">
                        <span>🖨️ طباعة</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Imprimer</span>
                    </div>
                </button>
            </div>

            <div class="instructions">
                <div class="bilingual-text">
                    <h4>تعليمات الاستخدام</h4>
                    <span class="separator">|</span>
                    <h4 class="fr-text">Instructions d'Utilisation</h4>
                </div>
                <ul>
                    <li>
                        <div class="bilingual-text">
                            <span>أدخل الرصيد الابتدائي لكل من الأرصدة الثلاثة</span>
                            <span class="separator">|</span>
                            <span class="fr-text">Saisir le solde initial pour chacun des trois soldes</span>
                        </div>
                    </li>
                    <li>
                        <div class="bilingual-text">
                            <span>أدخل عدد ومبلغ كل عملية مالية</span>
                            <span class="separator">|</span>
                            <span class="fr-text">Saisir le nombre et le montant de chaque opération financière</span>
                        </div>
                    </li>
                    <li>
                        <div class="bilingual-text">
                            <span>سيتم حساب الأرصدة النهائية والمجموع الإجمالي تلقائياً</span>
                            <span class="separator">|</span>
                            <span class="fr-text">Les soldes finaux et le total général seront calculés automatiquement</span>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- تقرير يومي -->
        <div id="rapport-jour" class="tab-content">
            <div class="page-title">
                <div class="bilingual-text">
                    <h2>التقرير اليومي</h2>
                    <span class="separator">|</span>
                    <h2 class="fr-text">Rapport Journalier</h2>
                </div>
            </div>
            
            <div style="margin-bottom: 25px; text-align: center; padding: 20px; background: linear-gradient(45deg, #e8f4fd, #d1ecf1); border-radius: 10px;">
                <div class="bilingual-text" style="margin-bottom: 15px;">
                    <label style="font-weight: bold; font-size: 16px;">التاريخ:</label>
                    <span class="separator">|</span>
                    <label class="fr-text" style="font-weight: bold; font-size: 16px;">Date:</label>
                </div>
                <input type="date" id="rapport-date" style="padding: 12px; margin: 12px; border: 2px solid #007bff; border-radius: 8px;">
                <br>
                <button class="btn" onclick="generateDailyReport()">
                    <div class="bilingual-text">
                        <span>📊 إنشاء التقرير</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Générer le Rapport</span>
                    </div>
                </button>
                <button class="btn btn-info" onclick="smartPrint()">
                    <div class="bilingual-text">
                        <span>🖨️ طباعة</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Imprimer</span>
                    </div>
                </button>
            </div>
            
            <div id="daily-report" class="report-content">
                <div id="daily-report-content">
                    <div style="text-align: center; padding: 50px; color: #666;">
                        <div class="bilingual-text">
                            <h3>اختر التاريخ وانقر على "إنشاء التقرير"</h3>
                            <span class="separator">|</span>
                            <h3 class="fr-text">Sélectionner la date et cliquer sur "Générer le Rapport"</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- تقرير شهري -->
        <div id="rapport-mensuel" class="tab-content">
            <div class="page-title">
                <div class="bilingual-text">
                    <h2>التقرير الشهري</h2>
                    <span class="separator">|</span>
                    <h2 class="fr-text">Rapport Mensuel</h2>
                </div>
            </div>
            
            <div style="margin-bottom: 25px; text-align: center; padding: 20px; background: linear-gradient(45deg, #e8f4fd, #d1ecf1); border-radius: 10px;">
                <div class="bilingual-text" style="margin-bottom: 15px;">
                    <label style="font-weight: bold; font-size: 16px;">الشهر والسنة:</label>
                    <span class="separator">|</span>
                    <label class="fr-text" style="font-weight: bold; font-size: 16px;">Mois et Année:</label>
                </div>
                <select id="month-select" style="padding: 12px; margin: 12px; border: 2px solid #007bff; border-radius: 8px;">
                    <option value="1">يناير - Janvier</option>
                    <option value="2">فبراير - Février</option>
                    <option value="3">مارس - Mars</option>
                    <option value="4">أبريل - Avril</option>
                    <option value="5">مايو - Mai</option>
                    <option value="6">يونيو - Juin</option>
                    <option value="7">يوليو - Juillet</option>
                    <option value="8">أغسطس - Août</option>
                    <option value="9">سبتمبر - Septembre</option>
                    <option value="10">أكتوبر - Octobre</option>
                    <option value="11">نوفمبر - Novembre</option>
                    <option value="12">ديسمبر - Décembre</option>
                </select>
                <select id="year-select" style="padding: 12px; margin: 12px; border: 2px solid #007bff; border-radius: 8px;">
                    <!-- سيتم ملؤها بالسنوات -->
                </select>
                <br>
                <button class="btn" onclick="generateMonthlyReport()">
                    <div class="bilingual-text">
                        <span>📈 إنشاء التقرير</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Générer le Rapport</span>
                    </div>
                </button>
                <button class="btn btn-info" onclick="smartPrint()">
                    <div class="bilingual-text">
                        <span>🖨️ طباعة</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Imprimer</span>
                    </div>
                </button>
            </div>
            
            <div id="monthly-report" class="report-content">
                <div id="monthly-report-content">
                    <div style="text-align: center; padding: 50px; color: #666;">
                        <div class="bilingual-text">
                            <h3>اختر الشهر والسنة وانقر على "إنشاء التقرير"</h3>
                            <span class="separator">|</span>
                            <h3 class="fr-text">Sélectionner le mois et l'année puis cliquer sur "Générer le Rapport"</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- السجل التاريخي -->
        <div id="historique" class="tab-content">
            <div class="page-title">
                <div class="bilingual-text">
                    <h2>السجل التاريخي</h2>
                    <span class="separator">|</span>
                    <h2 class="fr-text">Historique</h2>
                </div>
            </div>
            
            <div style="margin-bottom: 25px; text-align: center; padding: 20px; background: linear-gradient(45deg, #e8f4fd, #d1ecf1); border-radius: 10px;">
                <button class="btn" onclick="loadHistory()">
                    <div class="bilingual-text">
                        <span>🔄 تحديث السجل</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Actualiser l'Historique</span>
                    </div>
                </button>
                <button class="btn btn-info" onclick="exportData()">
                    <div class="bilingual-text">
                        <span>📤 تصدير البيانات</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Exporter les Données</span>
                    </div>
                </button>
            </div>
            
            <div style="overflow-x: auto; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>
                                <div class="bilingual-text">
                                    <span>📅 التاريخ</span>
                                    <span class="separator">|</span>
                                    <span class="fr-text">Date</span>
                                </div>
                            </th>
                            <th>
                                <div class="bilingual-text">
                                    <span>💵 الصندوق</span>
                                    <span class="separator">|</span>
                                    <span class="fr-text">CAISSE</span>
                                </div>
                            </th>
                            <th>
                                <div class="bilingual-text">
                                    <span>🔄 فنديكس</span>
                                    <span class="separator">|</span>
                                    <span class="fr-text">FUNDEX</span>
                                </div>
                            </th>
                            <th>
                                <div class="bilingual-text">
                                    <span>💳 ضمان باي</span>
                                    <span class="separator">|</span>
                                    <span class="fr-text">DAMANE PAY</span>
                                </div>
                            </th>
                            <th>
                                <div class="bilingual-text">
                                    <span>📊 المجموع</span>
                                    <span class="separator">|</span>
                                    <span class="fr-text">Total</span>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="history-tbody">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 30px; color: #666;">
                                <div class="bilingual-text">
                                    <span>لا توجد سجلات محفوظة</span>
                                    <span class="separator">|</span>
                                    <span class="fr-text">Aucun enregistrement sauvegardé</span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal للمدخلات -->
    <div id="identifierModal" class="modal">
        <div class="modal-content">
            <h3>
                <div class="bilingual-text">
                    <span>✏️ تغيير معرف الشركة</span>
                    <span class="separator">|</span>
                    <span class="fr-text">Modifier l'Identifiant</span>
                </div>
            </h3>
            <div class="bilingual-text" style="margin-bottom: 20px; color: #666;">
                <span>أدخل المعرف الجديد</span>
                <span class="separator">|</span>
                <span class="fr-text">Saisir le nouvel identifiant</span>
            </div>
            <input type="text" id="newIdentifierInput" class="modal-input" placeholder="مثال: 1234" maxlength="10">
            <div class="modal-buttons">
                <button class="modal-btn confirm" onclick="updateIdentifier()">
                    <div class="bilingual-text">
                        <span>✅ حفظ</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Enregistrer</span>
                    </div>
                </button>
                <button class="modal-btn cancel" onclick="closeModal()">
                    <div class="bilingual-text">
                        <span>❌ إلغاء</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Annuler</span>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <script>
        // متغيرات النظام
        let journalData = JSON.parse(localStorage.getItem('journalData')) || [];
        let systemConfig = JSON.parse(localStorage.getItem('systemConfig')) || {
            companyIdentifier: null,
            isFirstTime: true,
            adminPassword: 'admin123',
            userPassword: 'user123'
        };
        let currentUser = null;
        
        // === دوال إدارة النظام والمستخدمين ===
        function initializeSystem() {
            // التحقق من الإعداد الأولي
            if (systemConfig.isFirstTime || !systemConfig.companyIdentifier) {
                showSetupScreen();
            } else {
                showLoginScreen();
            }
        }
        
        function showSetupScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        }
        
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'none';
        }
        
        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // عرض المعرف في الواجهة
            updateIdentifierDisplay();
            
            // عرض لوحة الأدمن إذا كان المستخدم أدمن
            if (currentUser && currentUser.type === 'admin') {
                document.getElementById('adminPanel').style.display = 'block';
                refreshStats();
            } else {
                document.getElementById('adminPanel').style.display = 'none';
            }
            
            // تحديث معلومات المستخدم
            updateUserInfo();
        }
        
        function setupSystem() {
            const identifier = document.getElementById('companyIdentifier').value.trim();
            
            if (!identifier) {
                alert('يرجى إدخال معرف الشركة\nVeuillez saisir l\'identifiant de l\'entreprise');
                return;
            }
            
            if (identifier.length < 2) {
                alert('المعرف يجب أن يكون أكثر من حرف واحد\nL\'identifiant doit contenir plus d\'un caractère');
                return;
            }
            
            // حفظ الإعدادات
            systemConfig.companyIdentifier = identifier;
            systemConfig.isFirstTime = false;
            localStorage.setItem('systemConfig', JSON.stringify(systemConfig));
            
            alert('🎉 تم إعداد النظام بنجاح!\n🎉 Système configuré avec succès!');
            
            // الانتقال لشاشة تسجيل الدخول
            showLoginScreen();
        }
        
        function login(event) {
            event.preventDefault();
            
            const userType = document.getElementById('userType').value;
            const password = document.getElementById('password').value;
            
            if (!userType || !password) {
                alert('يرجى ملء جميع الحقول\nVeuillez remplir tous les champs');
                return;
            }
            
            // التحقق من كلمة المرور
            let isValid = false;
            if (userType === 'admin' && password === systemConfig.adminPassword) {
                isValid = true;
            } else if (userType === 'user' && password === systemConfig.userPassword) {
                isValid = true;
            }
            
            if (isValid) {
                currentUser = {
                    type: userType,
                    loginTime: new Date()
                };
                
                // حفظ حالة تسجيل الدخول
                sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                showMainApp();
            } else {
                alert('كلمة مرور خاطئة!\nMot de passe incorrect!');
                document.getElementById('password').value = '';
            }
        }
        
        function logout() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟\nÊtes-vous sûr de vouloir vous déconnecter?')) {
                currentUser = null;
                sessionStorage.removeItem('currentUser');
                showLoginScreen();
                
                // مسح الحقول
                document.getElementById('userType').value = '';
                document.getElementById('password').value = '';
            }
        }
        
        function updateUserInfo() {
            if (currentUser) {
                const userDisplay = currentUser.type === 'admin' ? 
                    '👨‍💼 مدير النظام | Administrateur' : 
                    '👤 مستخدم | Utilisateur';
                document.getElementById('currentUser').textContent = userDisplay;
            }
        }
        
        function updateIdentifierDisplay() {
            const identifier = systemConfig.companyIdentifier || '---';
            document.getElementById('displayIdentifier').textContent = identifier;
            document.getElementById('displayIdentifierFr').textContent = identifier;
            document.getElementById('currentIdentifier').textContent = identifier;
            document.getElementById('currentIdentifierFr').textContent = identifier;
        }
        
        // === دوال إدارة المعرف (للأدمن فقط) ===
        function changeIdentifier() {
            if (currentUser.type !== 'admin') {
                alert('هذه الصلاحية متاحة للمدير فقط!\nCette fonction est réservée à l\'administrateur!');
                return;
            }
            
            document.getElementById('identifierModal').style.display = 'block';
            document.getElementById('newIdentifierInput').value = systemConfig.companyIdentifier || '';
            document.getElementById('newIdentifierInput').focus();
        }
        
        function updateIdentifier() {
            const newIdentifier = document.getElementById('newIdentifierInput').value.trim();
            
            if (!newIdentifier) {
                alert('يرجى إدخال معرف صحيح\nVeuillez saisir un identifiant valide');
                return;
            }
            
            if (newIdentifier.length < 2) {
                alert('المعرف يجب أن يكون أكثر من حرف واحد\nL\'identifiant doit contenir plus d\'un caractère');
                return;
            }
            
            // تحديث المعرف
            systemConfig.companyIdentifier = newIdentifier;
            localStorage.setItem('systemConfig', JSON.stringify(systemConfig));
            
            // تحديث العرض
            updateIdentifierDisplay();
            
            closeModal();
            
            alert('✅ تم تحديث المعرف بنجاح!\n✅ Identifiant mis à jour avec succès!');
        }
        
        function closeModal() {
            document.getElementById('identifierModal').style.display = 'none';
        }
        
        // === دوال إدارة البيانات (للأدمن فقط) ===
        function backupData() {
            if (currentUser.type !== 'admin') {
                alert('هذه الصلاحية متاحة للمدير فقط!\nCette fonction est réservée à l\'administrateur!');
                return;
            }
            
            if (journalData.length === 0) {
                alert('لا توجد بيانات للنسخ الاحتياطي\nAucune donnée à sauvegarder');
                return;
            }
            
            const backupData = {
                version: '2.1',
                created: new Date().toISOString(),
                systemConfig: systemConfig,
                journalData: journalData,
                metadata: {
                    totalRecords: journalData.length,
                    exportedBy: currentUser.type
                }
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `EXPER_CASH_Backup_${systemConfig.companyIdentifier}_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('✅ تم إنشاء النسخة الاحتياطية بنجاح!\n✅ Sauvegarde créée avec succès!');
        }
        
        function clearAllData() {
            if (currentUser.type !== 'admin') {
                alert('هذه الصلاحية متاحة للمدير فقط!\nCette fonction est réservée à l\'administrateur!');
                return;
            }
            
            if (confirm('⚠️ تحذير: سيتم حذف جميع البيانات نهائياً!\n⚠️ Attention: Toutes les données seront supprimées définitivement!\n\nهل أنت متأكد؟\nÊtes-vous sûr?')) {
                if (confirm('تأكيد نهائي: هذا الإجراء لا يمكن التراجع عنه!\nConfirmation finale: Cette action est irréversible!')) {
                    // مسح البيانات
                    journalData = [];
                    localStorage.removeItem('journalData');
                    
                    // تحديث العرض
                    loadHistory();
                    refreshStats();
                    clearForm();
                    
                    alert('🗑️ تم مسح جميع البيانات!\n🗑️ Toutes les données ont été supprimées!');
                }
            }
        }
        
        function refreshStats() {
            const recordCount = journalData.length;
            document.getElementById('recordCount').textContent = recordCount;
            document.getElementById('recordCountFr').textContent = recordCount;
        }
        
        // === الدوال الأساسية للنظام ===
        function switchTab(tabName, clickedTab) {
            // إخفاء جميع المحتوى
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // إخفاء جميع التابات
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // إظهار التاب المحدد
            document.getElementById(tabName).classList.add('active');
            clickedTab.classList.add('active');
        }
        
        function clearForm() {
            // مسح جميع الحقول الرقمية ما عدا التاريخ والحقول المحسوبة
            const inputs = document.querySelectorAll('input[type="number"]:not([readonly])');
            inputs.forEach(input => {
                if (!input.id.includes('final')) {
                    input.value = '';
                }
            });
            
            // إعادة تعيين الأرصدة النهائية
            document.getElementById('caisse-final').value = '';
            document.getElementById('fundex-final').value = '';
            document.getElementById('damane-final').value = '';
            
            document.getElementById('total-caisse').textContent = '0.00';
            document.getElementById('total-fundex').textContent = '0.00';
            document.getElementById('total-damane').textContent = '0.00';
            document.getElementById('total-all').textContent = '0.00';
            
            // تعيين التاريخ الحالي مرة أخرى
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
        }

        function calculateTotals() {
            // حساب رصيد الصندوق
            const caisseInitial = parseFloat(document.getElementById('caisse-initial').value) || 0;
            let caisseFinal = caisseInitial;
            
            // CRÉDIT للصندوق
            caisseFinal += (parseFloat(document.getElementById('caisse-credit-espece-montant').value) || 0);
            caisseFinal += (parseFloat(document.getElementById('caisse-credit-banque-montant').value) || 0);
            caisseFinal += (parseFloat(document.getElementById('caisse-credit-others-montant').value) || 0);
            
            // DÉBIT للصندوق
            caisseFinal -= (parseFloat(document.getElementById('caisse-debit-espece-montant').value) || 0);
            caisseFinal -= (parseFloat(document.getElementById('caisse-debit-others-montant').value) || 0);
            
            // حساب رصيد Fundex
            const fundexInitial = parseFloat(document.getElementById('fundex-initial').value) || 0;
            let fundexFinal = fundexInitial;
            
            // CRÉDIT لـ Fundex
            fundexFinal += (parseFloat(document.getElementById('fundex-wu-reception-montant').value) || 0);
            fundexFinal += (parseFloat(document.getElementById('fundex-mg-montant').value) || 0);
            fundexFinal += (parseFloat(document.getElementById('fundex-mi-montant').value) || 0);
            fundexFinal += (parseFloat(document.getElementById('fundex-int-other-montant').value) || 0);
            fundexFinal += (parseFloat(document.getElementById('fundex-rapido-reception-montant').value) || 0);
            fundexFinal += (parseFloat(document.getElementById('fundex-decharge-montant').value) || 0);
            
            // DÉBIT لـ Fundex
            fundexFinal -= (parseFloat(document.getElementById('fundex-wu-envois-montant').value) || 0);
            fundexFinal -= (parseFloat(document.getElementById('fundex-charge-montant').value) || 0);
            fundexFinal -= (parseFloat(document.getElementById('fundex-rapido-envois-montant').value) || 0);
            fundexFinal -= (parseFloat(document.getElementById('fundex-vignette-montant').value) || 0);
            
            // حساب رصيد Damane Pay
            const damaneInitial = parseFloat(document.getElementById('damane-initial').value) || 0;
            let damaneFinal = damaneInitial;
            
            // CRÉDIT لـ Damane Pay
            damaneFinal += (parseFloat(document.getElementById('damane-retrait-client-montant').value) || 0);
            damaneFinal += (parseFloat(document.getElementById('damane-cnss-montant').value) || 0);
            damaneFinal += (parseFloat(document.getElementById('damane-charge-montant').value) || 0);
            damaneFinal += (parseFloat(document.getElementById('damane-ria-montant').value) || 0);
            damaneFinal += (parseFloat(document.getElementById('damane-mg-montant').value) || 0);
            damaneFinal += (parseFloat(document.getElementById('damane-dirham-montant').value) || 0);
            damaneFinal += (parseFloat(document.getElementById('damane-ansari-montant').value) || 0);
            damaneFinal += (parseFloat(document.getElementById('damane-mandat-reception-montant').value) || 0);
            damaneFinal += (parseFloat(document.getElementById('damane-vente-carte-montant').value) || 0);
            damaneFinal += (parseFloat(document.getElementById('damane-int-autres-montant').value) || 0);
            
            // DÉBIT لـ Damane Pay
            damaneFinal -= (parseFloat(document.getElementById('damane-decharge-boa-montant').value) || 0);
            damaneFinal -= (parseFloat(document.getElementById('damane-versement-dp-console-montant').value) || 0);
            damaneFinal -= (parseFloat(document.getElementById('damane-virement-banque-montant').value) || 0);
            damaneFinal -= (parseFloat(document.getElementById('damane-versement-client-montant').value) || 0);
            damaneFinal -= (parseFloat(document.getElementById('damane-mandat-envois-montant').value) || 0);
            damaneFinal -= (parseFloat(document.getElementById('damane-factures-montant').value) || 0);
            
            // حساب المجموع الإجمالي
            const totalAll = caisseFinal + fundexFinal + damaneFinal;
            
            // تحديث العرض
            document.getElementById('caisse-final').value = caisseFinal.toFixed(2);
            document.getElementById('fundex-final').value = fundexFinal.toFixed(2);
            document.getElementById('damane-final').value = damaneFinal.toFixed(2);
            
            document.getElementById('total-caisse').textContent = caisseFinal.toFixed(2);
            document.getElementById('total-fundex').textContent = fundexFinal.toFixed(2);
            document.getElementById('total-damane').textContent = damaneFinal.toFixed(2);
            document.getElementById('total-all').textContent = totalAll.toFixed(2);
        }
        
        function addCalculationListeners() {
            const inputs = document.querySelectorAll('input[type="number"]:not([readonly])');
            
            inputs.forEach(input => {
                // إزالة المستمعات القديمة أولاً
                input.removeEventListener('input', calculateTotals);
                input.removeEventListener('change', calculateTotals);
                
                // إضافة المستمعات الجديدة
                input.addEventListener('input', calculateTotals);
                input.addEventListener('change', calculateTotals);
            });
        }
        
        function saveData() {
            const data = {
                date: document.getElementById('date').value,
                identifier: systemConfig.companyIdentifier,
                
                balances: {
                    caisse: {
                        initial: parseFloat(document.getElementById('caisse-initial').value) || 0,
                        j1: parseFloat(document.getElementById('caisse-j1').value) || 0,
                        final: parseFloat(document.getElementById('caisse-final').value) || 0
                    },
                    fundex: {
                        initial: parseFloat(document.getElementById('fundex-initial').value) || 0,
                        j1: parseFloat(document.getElementById('fundex-j1').value) || 0,
                        final: parseFloat(document.getElementById('fundex-final').value) || 0
                    },
                    damane: {
                        initial: parseFloat(document.getElementById('damane-initial').value) || 0,
                        j1: parseFloat(document.getElementById('damane-j1').value) || 0,
                        final: parseFloat(document.getElementById('damane-final').value) || 0
                    }
                },
                
                operations: {
                    caisse: {
                        credit: (parseFloat(document.getElementById('caisse-credit-espece-montant').value) || 0) + 
                               (parseFloat(document.getElementById('caisse-credit-banque-montant').value) || 0) + 
                               (parseFloat(document.getElementById('caisse-credit-others-montant').value) || 0),
                        debit: (parseFloat(document.getElementById('caisse-debit-espece-montant').value) || 0) + 
                              (parseFloat(document.getElementById('caisse-debit-others-montant').value) || 0)
                    },
                    fundex: {
                        credit: (parseFloat(document.getElementById('fundex-wu-reception-montant').value) || 0) + 
                               (parseFloat(document.getElementById('fundex-mg-montant').value) || 0) + 
                               (parseFloat(document.getElementById('fundex-mi-montant').value) || 0) + 
                               (parseFloat(document.getElementById('fundex-rapido-reception-montant').value) || 0) + 
                               (parseFloat(document.getElementById('fundex-decharge-montant').value) || 0) +
                               (parseFloat(document.getElementById('fundex-int-other-montant').value) || 0),
                        debit: (parseFloat(document.getElementById('fundex-wu-envois-montant').value) || 0) + 
                              (parseFloat(document.getElementById('fundex-charge-montant').value) || 0) + 
                              (parseFloat(document.getElementById('fundex-rapido-envois-montant').value) || 0) + 
                              (parseFloat(document.getElementById('fundex-vignette-montant').value) || 0)
                    },
                    damane: {
                        credit: (parseFloat(document.getElementById('damane-retrait-client-montant').value) || 0) + 
                               (parseFloat(document.getElementById('damane-cnss-montant').value) || 0) + 
                               (parseFloat(document.getElementById('damane-charge-montant').value) || 0) + 
                               (parseFloat(document.getElementById('damane-ria-montant').value) || 0) + 
                               (parseFloat(document.getElementById('damane-mg-montant').value) || 0) + 
                               (parseFloat(document.getElementById('damane-dirham-montant').value) || 0) + 
                               (parseFloat(document.getElementById('damane-ansari-montant').value) || 0) + 
                               (parseFloat(document.getElementById('damane-mandat-reception-montant').value) || 0) + 
                               (parseFloat(document.getElementById('damane-vente-carte-montant').value) || 0) +
                               (parseFloat(document.getElementById('damane-int-autres-montant').value) || 0),
                        debit: (parseFloat(document.getElementById('damane-decharge-boa-montant').value) || 0) + 
                              (parseFloat(document.getElementById('damane-versement-dp-console-montant').value) || 0) + 
                              (parseFloat(document.getElementById('damane-virement-banque-montant').value) || 0) + 
                              (parseFloat(document.getElementById('damane-versement-client-montant').value) || 0) + 
                              (parseFloat(document.getElementById('damane-mandat-envois-montant').value) || 0) + 
                              (parseFloat(document.getElementById('damane-factures-montant').value) || 0)
                    }
                },
                totalAll: parseFloat(document.getElementById('total-all').textContent) || 0,
                timestamp: new Date().toISOString(),
                createdBy: currentUser.type
            };
            
            // التحقق من وجود سجل بنفس التاريخ
            const existingIndex = journalData.findIndex(item => item.date === data.date);
            if (existingIndex !== -1) {
                if (confirm('يوجد سجل بهذا التاريخ. هل تريد استبداله؟\nUn enregistrement existe pour cette date. Voulez-vous le remplacer?')) {
                    journalData[existingIndex] = data;
                } else {
                    return;
                }
            } else {
                journalData.push(data);
            }
            
            // ترتيب البيانات حسب التاريخ
            journalData.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // حفظ في التخزين المحلي
            localStorage.setItem('journalData', JSON.stringify(journalData));
            
            alert('تم حفظ البيانات بنجاح! 🎉\nDonnées sauvegardées avec succès!');
            
            // تحديث الإحصائيات إذا كان المستخدم أدمن
            if (currentUser.type === 'admin') {
                refreshStats();
            }
            
            clearForm();
        }
        
        function generateDailyReport() {
            const selectedDate = document.getElementById('rapport-date').value;
            const data = journalData.find(item => item.date === selectedDate);
            
            const reportContent = document.getElementById('daily-report-content');
            
            if (!data) {
                reportContent.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #666;">
                        <div class="bilingual-text">
                            <h3>لا توجد بيانات لهذا التاريخ</h3>
                            <span class="separator">|</span>
                            <h3 class="fr-text">Aucune donnée pour cette date</h3>
                        </div>
                        <p style="margin-top: 15px; font-size: 18px; font-weight: bold;">${selectedDate}</p>
                    </div>`;
                return;
            }
            
            const formattedDate = new Date(data.date).toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            const formattedDateFr = new Date(data.date).toLocaleDateString('fr-FR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });

            // جمع العمليات التي تم إدراجها فقط
            const operations = [];
            
            // عمليات الصندوق
            if (parseFloat(document.getElementById('caisse-credit-espece-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'caisse',
                    operation: 'النقد المضاف للصندوق | Espèces Ajoutées',
                    credit: parseFloat(document.getElementById('caisse-credit-espece-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('caisse-credit-banque-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'caisse',
                    operation: 'البنك | Banque',
                    credit: parseFloat(document.getElementById('caisse-credit-banque-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('caisse-credit-others-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'caisse',
                    operation: 'أخرى | Autres (دائن)',
                    credit: parseFloat(document.getElementById('caisse-credit-others-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('caisse-debit-espece-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'caisse',
                    operation: 'النقد المسحوب | Espèces Retirées',
                    credit: 0,
                    debit: parseFloat(document.getElementById('caisse-debit-espece-montant').value)
                });
            }
            if (parseFloat(document.getElementById('caisse-debit-others-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'caisse',
                    operation: 'أخرى | Autres (مدين)',
                    credit: 0,
                    debit: parseFloat(document.getElementById('caisse-debit-others-montant').value)
                });
            }

            // عمليات Fundex - التحويل الدولي
            if (parseFloat(document.getElementById('fundex-wu-reception-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'fundex',
                    operation: 'استقبال ويسترن يونيون | Western Union Réception',
                    credit: parseFloat(document.getElementById('fundex-wu-reception-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('fundex-wu-envois-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'fundex',
                    operation: 'إرسال ويسترن يونيون | Western Union Envois',
                    credit: 0,
                    debit: parseFloat(document.getElementById('fundex-wu-envois-montant').value)
                });
            }
            if (parseFloat(document.getElementById('fundex-mg-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'fundex',
                    operation: 'موني جرام | MoneyGram',
                    credit: parseFloat(document.getElementById('fundex-mg-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('fundex-mi-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'fundex',
                    operation: 'موني انترناشيونال | Money International',
                    credit: parseFloat(document.getElementById('fundex-mi-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('fundex-int-other-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'fundex',
                    operation: 'أخرى دولي | Autres International',
                    credit: parseFloat(document.getElementById('fundex-int-other-montant').value),
                    debit: 0
                });
            }

            // عمليات Fundex - التحويل الوطني
            if (parseFloat(document.getElementById('fundex-rapido-reception-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'fundex',
                    operation: 'استقبال رابيدو | Rapido Réceptions',
                    credit: parseFloat(document.getElementById('fundex-rapido-reception-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('fundex-rapido-envois-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'fundex',
                    operation: 'إرسال رابيدو | Rapido Envois',
                    credit: 0,
                    debit: parseFloat(document.getElementById('fundex-rapido-envois-montant').value)
                });
            }

            // عمليات Fundex - خدمات أخرى
            if (parseFloat(document.getElementById('fundex-decharge-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'fundex',
                    operation: 'شحن رصيد فنديكس | Charge Sold Fundex',
                    credit: parseFloat(document.getElementById('fundex-decharge-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('fundex-charge-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'fundex',
                    operation: 'شحن إلى ضمان باي | Décharge vers Damane Pay',
                    credit: 0,
                    debit: parseFloat(document.getElementById('fundex-charge-montant').value)
                });
            }
            if (parseFloat(document.getElementById('fundex-vignette-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'fundex',
                    operation: 'الضريبة على السيارات | Taxe sur Véhicules',
                    credit: 0,
                    debit: parseFloat(document.getElementById('fundex-vignette-montant').value)
                });
            }

            // عمليات Damane Pay - العمليات الأساسية
            if (parseFloat(document.getElementById('damane-retrait-client-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'سحب عميل | Retrait Client',
                    credit: parseFloat(document.getElementById('damane-retrait-client-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('damane-cnss-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'دفع الضمان الاجتماعي | Paiement CNSS',
                    credit: parseFloat(document.getElementById('damane-cnss-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('damane-charge-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'شحن رصيد | Charge Sold',
                    credit: parseFloat(document.getElementById('damane-charge-montant').value),
                    debit: 0
                });
            }

            // عمليات Damane Pay - مدين
            if (parseFloat(document.getElementById('damane-decharge-boa-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'تفريغ إلى حساب BOA | Décharge vers compte BOA',
                    credit: 0,
                    debit: parseFloat(document.getElementById('damane-decharge-boa-montant').value)
                });
            }
            if (parseFloat(document.getElementById('damane-versement-dp-console-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'تحويل إلى كونسول آخر | Versement dp to other console',
                    credit: 0,
                    debit: parseFloat(document.getElementById('damane-versement-dp-console-montant').value)
                });
            }
            if (parseFloat(document.getElementById('damane-virement-banque-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'تحويل إلى حساب بنكي | Virement à compte banq',
                    credit: 0,
                    debit: parseFloat(document.getElementById('damane-virement-banque-montant').value)
                });
            }
            if (parseFloat(document.getElementById('damane-versement-client-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'إيداع عميل | Versement Client',
                    credit: 0,
                    debit: parseFloat(document.getElementById('damane-versement-client-montant').value)
                });
            }

            // عمليات Damane Pay - التحويل الدولي
            if (parseFloat(document.getElementById('damane-ria-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'ريا | RIA',
                    credit: parseFloat(document.getElementById('damane-ria-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('damane-mg-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'موني جرام | Money Gram',
                    credit: parseFloat(document.getElementById('damane-mg-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('damane-dirham-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'درهم اكسبريس | DIRHAM EXPRESS',
                    credit: parseFloat(document.getElementById('damane-dirham-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('damane-ansari-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'الأنصاري للصرافة | AL ANSARI EXCHANGE',
                    credit: parseFloat(document.getElementById('damane-ansari-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('damane-int-autres-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'أخرى دولي | Autres International',
                    credit: parseFloat(document.getElementById('damane-int-autres-montant').value),
                    debit: 0
                });
            }

            // عمليات Damane Pay - التحويل الوطني
            if (parseFloat(document.getElementById('damane-mandat-reception-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'استقبال مانديت اكسبريس | Mandat Express Réceptions',
                    credit: parseFloat(document.getElementById('damane-mandat-reception-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('damane-mandat-envois-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'إرسال مانديت اكسبريس | Mandat Express Envois',
                    credit: 0,
                    debit: parseFloat(document.getElementById('damane-mandat-envois-montant').value)
                });
            }

            // عمليات Damane Pay - خدمات أخرى
            if (parseFloat(document.getElementById('damane-vente-carte-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'بيع بطاقة ضمان باي | Vente Carte Damane Pay',
                    credit: parseFloat(document.getElementById('damane-vente-carte-montant').value),
                    debit: 0
                });
            }
            if (parseFloat(document.getElementById('damane-factures-montant')?.value || 0) > 0) {
                operations.push({
                    type: 'damane',
                    operation: 'جميع الفواتير | Toutes Factures',
                    credit: 0,
                    debit: parseFloat(document.getElementById('damane-factures-montant').value)
                });
            }

            reportContent.innerHTML = `
                <div style="padding: 30px; font-family: Arial, sans-serif; line-height: 1.4;">
                    <!-- Header -->
                    <div style="text-align: center; margin-bottom: 30px; border-bottom: 2px solid #312884; padding-bottom: 20px;">
                        <h2 style="color: #312884; margin-bottom: 10px;">EXPER CASH SERVICES SARL</h2>
                        <div style="background: #312884; color: white; padding: 8px 15px; display: inline-block; border-radius: 5px; font-weight: bold;">
                            SITUATION JOURNALIÈRE DES OPÉRATIONS
                        </div>
                        <div style="margin-top: 10px; font-size: 14px; color: #666;">
                            <strong>${formattedDateFr}</strong> • <strong>${formattedDate}</strong>
                        </div>
                    </div>

                    <!-- Account Info -->
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #312884;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <strong>المعرف | Identifiant:</strong> ${data.identifier || systemConfig.companyIdentifier}
                            </div>
                            <div>
                                <strong>التاريخ | Date:</strong> ${data.date}
                            </div>
                        </div>
                    </div>

                    <!-- Initial Balances -->
                    <div style="margin-bottom: 25px;">
                        <h3 style="color: #312884; margin-bottom: 15px; border-bottom: 1px solid #dee2e6; padding-bottom: 8px;">
                            الأرصدة الابتدائية | Soldes Initiaux
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                            <div style="background: linear-gradient(45deg, #d4edda, #c3e6cb); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #28a745;">
                                <div style="font-weight: bold; color: #155724; margin-bottom: 5px;">💵 الصندوق | CAISSE</div>
                                <div style="font-size: 18px; font-weight: bold;">${data.balances.caisse.initial.toFixed(2)} MAD</div>
                            </div>
                            <div style="background: linear-gradient(45deg, #cce5ff, #b3d9ff); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #007bff;">
                                <div style="font-weight: bold; color: #004085; margin-bottom: 5px;">🔄 فنديكس | FUNDEX</div>
                                <div style="font-size: 18px; font-weight: bold;">${data.balances.fundex.initial.toFixed(2)} MAD</div>
                            </div>
                            <div style="background: linear-gradient(45deg, #fff3cd, #ffe69c); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #ffc107;">
                                <div style="font-weight: bold; color: #856404; margin-bottom: 5px;">💳 ضمان باي | DAMANE PAY</div>
                                <div style="font-size: 18px; font-weight: bold;">${data.balances.damane.initial.toFixed(2)} MAD</div>
                            </div>
                        </div>
                    </div>

                    ${operations.length > 0 ? `
                    <!-- Operations Table -->
                    <div style="margin-bottom: 25px;">
                        <h3 style="color: #312884; margin-bottom: 15px; border-bottom: 1px solid #dee2e6; padding-bottom: 8px;">
                            العمليات المنجزة | Opérations Effectuées
                        </h3>
                        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <thead>
                                <tr style="background: #312884; color: white;">
                                    <th style="padding: 12px; text-align: right; border: 1px solid #dee2e6;">النوع | Type</th>
                                    <th style="padding: 12px; text-align: center; border: 1px solid #dee2e6;">العملية | Opération</th>
                                    <th style="padding: 12px; text-align: center; border: 1px solid #dee2e6;">مدين | Débit</th>
                                    <th style="padding: 12px; text-align: center; border: 1px solid #dee2e6;">دائن | Crédit</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${operations.map((op, index) => `
                                    <tr style="background: ${index % 2 === 0 ? '#f8f9fa' : 'white'};">
                                        <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center;">
                                            <span style="display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; color: white; background: ${
                                                op.type === 'caisse' ? '#28a745' : 
                                                op.type === 'fundex' ? '#007bff' : '#ffc107'
                                            };">
                                                ${op.type === 'caisse' ? 'صندوق' : op.type === 'fundex' ? 'فنديكس' : 'ضمان باي'}
                                            </span>
                                        </td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6; font-size: 13px;">${op.operation}</td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center; font-weight: bold; color: ${op.debit > 0 ? '#dc3545' : '#6c757d'};">
                                            ${op.debit > 0 ? op.debit.toFixed(2) : '-'}
                                        </td>
                                        <td style="padding: 10px; border: 1px solid #dee2e6; text-align: center; font-weight: bold; color: ${op.credit > 0 ? '#28a745' : '#6c757d'};">
                                            ${op.credit > 0 ? op.credit.toFixed(2) : '-'}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    ` : `
                    <div style="text-align: center; padding: 30px; background: #fff3cd; border-radius: 8px; border: 2px solid #ffc107; margin-bottom: 25px;">
                        <h4 style="color: #856404; margin-bottom: 10px;">⚠️ لا توجد عمليات مسجلة</h4>
                        <p style="color: #856404; margin: 0;">Aucune opération enregistrée pour cette journée</p>
                    </div>
                    `}

                    <!-- Final Balances -->
                    <div style="border: 2px solid #312884; border-radius: 12px; overflow: hidden; margin-bottom: 20px;">
                        <div style="background: #312884; color: white; padding: 15px; text-align: center;">
                            <h3 style="margin: 0; font-size: 18px;">الأرصدة النهائية | Soldes Finaux</h3>
                        </div>
                        <div style="padding: 20px; background: #f8f9fa;">
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; border: 2px solid #28a745;">
                                    <div style="color: #28a745; font-weight: bold; margin-bottom: 5px;">💵 الصندوق</div>
                                    <div style="color: #28a745; font-weight: bold; margin-bottom: 3px;">CAISSE</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #155724;">${data.balances.caisse.final.toFixed(2)} MAD</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; border: 2px solid #007bff;">
                                    <div style="color: #007bff; font-weight: bold; margin-bottom: 5px;">🔄 فنديكس</div>
                                    <div style="color: #007bff; font-weight: bold; margin-bottom: 3px;">FUNDEX</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #004085;">${data.balances.fundex.final.toFixed(2)} MAD</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; border: 2px solid #ffc107;">
                                    <div style="color: #e69500; font-weight: bold; margin-bottom: 5px;">💳 ضمان باي</div>
                                    <div style="color: #e69500; font-weight: bold; margin-bottom: 3px;">DAMANE PAY</div>
                                    <div style="font-size: 20px; font-weight: bold; color: #856404;">${data.balances.damane.final.toFixed(2)} MAD</div>
                                </div>
                            </div>
                            
                            <!-- Total -->
                            <div style="background: linear-gradient(45deg, #312884, #4a3799); color: white; padding: 20px; border-radius: 10px; text-align: center; border: 3px solid #fbbb0b;">
                                <div style="font-size: 16px; margin-bottom: 8px; opacity: 0.9;">المجموع الإجمالي | TOTAL GÉNÉRAL</div>
                                <div style="font-size: 28px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
                                    ${(data.balances.caisse.final + data.balances.fundex.final + data.balances.damane.final).toFixed(2)} MAD
                                </div>
                                <div style="font-size: 14px; margin-top: 8px; opacity: 0.8; border-top: 1px solid #fbbb0b; padding-top: 8px;">
                                    إجمالي يوم العمل | Total Journée de Travail
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #dee2e6; color: #6c757d; font-size: 12px;">
                        <p style="margin: 0;">Document généré automatiquement le ${new Date().toLocaleDateString('fr-FR')} à ${new Date().toLocaleTimeString('fr-FR')}</p>
                        <p style="margin: 5px 0 0 0;">EXPER CASH SERVICES SARL - Identifiant: ${data.identifier || systemConfig.companyIdentifier}</p>
                    </div>
                </div>
            `;
        }
        
        function generateMonthlyReport() {
            const selectedMonth = parseInt(document.getElementById('month-select').value);
            const selectedYear = parseInt(document.getElementById('year-select').value);
            
            const monthlyData = journalData.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate.getMonth() + 1 === selectedMonth && itemDate.getFullYear() === selectedYear;
            });
            
            if (monthlyData.length === 0) {
                document.getElementById('monthly-report-content').innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #666;">
                        <div class="bilingual-text">
                            <h3>لا توجد بيانات لهذا الشهر</h3>
                            <span class="separator">|</span>
                            <h3 class="fr-text">Aucune donnée pour ce mois</h3>
                        </div>
                    </div>`;
                return;
            }
            
            const monthNamesAr = ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو',
                              'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
            
            const monthNamesFr = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin',
                              'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'];
            
            let totalCaisse = 0, totalFundex = 0, totalDamane = 0;
            monthlyData.forEach(item => {
                totalCaisse += item.balances.caisse.final;
                totalFundex += item.balances.fundex.final;
                totalDamane += item.balances.damane.final;
            });
            
            const avgCaisse = (totalCaisse / monthlyData.length).toFixed(2);
            const avgFundex = (totalFundex / monthlyData.length).toFixed(2);
            const avgDamane = (totalDamane / monthlyData.length).toFixed(2);
            
            document.getElementById('monthly-report-content').innerHTML = `
                <div class="report-header">
                    <img src="https://www.adm.co.ma/sites/default/files/inline-images/logo_damanecash_vf_bb1.png" 
                         alt="Logo" style="width: 80px; float: right; margin-top: -15px;" onerror="this.style.display='none'">
                    <h2>EXPER CASH SERVICES SARL</h2>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
                        <img src="https://www.adm.co.ma/sites/default/files/inline-images/logo_damanecash_vf_bb1.png" 
                             alt="ضمان كاش" style="width: 50px; height: 50px; border-radius: 8px;" onerror="this.style.display='none'">
                        <div>
                            <div class="bilingual-text" style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">
                                <span>التقرير الشهري - المعرف: ${systemConfig.companyIdentifier}</span>
                                <span class="separator">|</span>
                                <span class="fr-text">Rapport Mensuel - ID: ${systemConfig.companyIdentifier}</span>
                            </div>
                            <div class="bilingual-text" style="font-size: 16px;">
                                <span>${monthNamesAr[selectedMonth-1]} ${selectedYear}</span>
                                <span class="separator">|</span>
                                <span class="fr-text">${monthNamesFr[selectedMonth-1]} ${selectedYear}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="background: linear-gradient(45deg, #f8f9fa, #e9ecef); padding: 25px; border-radius: 12px; margin-bottom: 25px; border: 2px solid #007bff;">
                    <div class="bilingual-text" style="font-size: 20px; font-weight: bold; margin-bottom: 20px; color: #2c3e50;">
                        <span>ملخص الشهر</span>
                        <span class="separator">|</span>
                        <span class="fr-text">Résumé du Mois</span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #312884;">
                            <div class="bilingual-text" style="font-weight: bold; margin-bottom: 10px;">
                                <span>📅 عدد أيام العمل</span>
                                <span class="separator">|</span>
                                <span class="fr-text">Jours de Travail</span>
                            </div>
                            <div style="font-size: 24px; font-weight: bold; color: #312884;">${monthlyData.length}</div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #fbbb0b;">
                            <div class="bilingual-text" style="font-weight: bold; margin-bottom: 10px;">
                                <span>💰 إجمالي الأرصدة</span>
                                <span class="separator">|</span>
                                <span class="fr-text">Total des Soldes</span>
                            </div>
                            <div style="font-size: 24px; font-weight: bold; color: #fbbb0b;">${(totalCaisse + totalFundex + totalDamane).toFixed(2)}</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function loadHistory() {
            const tbody = document.getElementById('history-tbody');
            tbody.innerHTML = '';
            
            if (journalData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 30px; color: #666;">
                            <div class="bilingual-text">
                                <span>لا توجد سجلات محفوظة</span>
                                <span class="separator">|</span>
                                <span class="fr-text">Aucun enregistrement sauvegardé</span>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            journalData.forEach(item => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #dee2e6';
                row.style.transition = 'background 0.3s ease';
                
                const formattedDateAr = new Date(item.date).toLocaleDateString('ar-SA');
                const formattedDateFr = new Date(item.date).toLocaleDateString('fr-FR');
                const totalAmount = (item.balances.caisse.final + item.balances.fundex.final + item.balances.damane.final).toFixed(2);
                
                row.innerHTML = `
                    <td style="padding: 15px;">
                        <div class="bilingual-text">
                            <span>${formattedDateAr}</span>
                            <span class="separator">|</span>
                            <span class="fr-text">${formattedDateFr}</span>
                        </div>
                    </td>
                    <td style="padding: 15px; text-align: center; color: #28a745; font-weight: bold; font-size: 16px;">${item.balances.caisse.final.toFixed(2)}</td>
                    <td style="padding: 15px; text-align: center; color: #007bff; font-weight: bold; font-size: 16px;">${item.balances.fundex.final.toFixed(2)}</td>
                    <td style="padding: 15px; text-align: center; color: #e69500; font-weight: bold; font-size: 16px;">${item.balances.damane.final.toFixed(2)}</td>
                    <td style="padding: 15px; text-align: center; color: #6f42c1; font-weight: bold; font-size: 18px;">${totalAmount}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function exportData() {
            if (journalData.length === 0) {
                alert('لا توجد بيانات للتصدير\nAucune donnée à exporter');
                return;
            }
            
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Date,التاريخ,Identifier,المعرف,Caisse Final,الصندوق النهائي,Fundex Final,فنديكس النهائي,Damane Final,ضمان النهائي,Total,المجموع\n"
                + journalData.map(item => 
                    `${item.date},${item.date},${item.identifier || systemConfig.companyIdentifier},${item.identifier || systemConfig.companyIdentifier},${item.balances.caisse.final.toFixed(2)},${item.balances.caisse.final.toFixed(2)},${item.balances.fundex.final.toFixed(2)},${item.balances.fundex.final.toFixed(2)},${item.balances.damane.final.toFixed(2)},${item.balances.damane.final.toFixed(2)},${(item.balances.caisse.final + item.balances.fundex.final + item.balances.damane.final).toFixed(2)},${(item.balances.caisse.final + item.balances.fundex.final + item.balances.damane.final).toFixed(2)}`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `exper_cash_data_${systemConfig.companyIdentifier}_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('تم تصدير البيانات بنجاح! 📁\nDonnées exportées avec succès!');
        }
        
        function smartPrint() {
            window.print();
        }
        
        // === التهيئة الأولية ===
        document.addEventListener('DOMContentLoaded', function() {
            // التحقق من حالة تسجيل الدخول المحفوظة
            const savedUser = sessionStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            } else {
                initializeSystem();
            }
            
            // تعيين التاريخ الحالي
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('date')) {
                document.getElementById('date').value = today;
            }
            if (document.getElementById('rapport-date')) {
                document.getElementById('rapport-date').value = today;
            }
            
            // ملء سنوات التقرير الشهري
            if (document.getElementById('year-select')) {
                const yearSelect = document.getElementById('year-select');
                const currentYear = new Date().getFullYear();
                for (let year = currentYear - 5; year <= currentYear + 1; year++) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    if (year === currentYear) option.selected = true;
                    yearSelect.appendChild(option);
                }
            }
            
            // تعيين الشهر الحالي
            if (document.getElementById('month-select')) {
                document.getElementById('month-select').value = new Date().getMonth() + 1;
            }
            
            // إضافة مستمعي الأحداث للحسابات التلقائية
            setTimeout(() => {
                addCalculationListeners();
                calculateTotals();
                loadHistory();
            }, 500);
            
            // إضافة مستمع لإغلاق المودال بـ Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });
            
            console.log('✅ النظام جاهز - System Ready');
        });
    </script>
</body>
</html>